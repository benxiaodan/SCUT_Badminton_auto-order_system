# 华工羽毛球订场系统 (SCUT Badminton Auto-Order System)

这是一个基于 Flask (后端) 和 React (前端) 的华工羽毛球场自动订场系统。旨在自动化解决订场难、繁琐的问题，支持智能登录、多账号管理、自动抢票及无限锁场等高级功能。

## ✨ 主要特性 (Features)

*   **智能登录系统**：
    *   **自动识别与跳转**：自动点击“校内账号登录”。
    *   **2FA 支持**：检测到双重验证 (2FA) 时，后端会保持会话并提示输入验证码（需配合前端或 API 查看日志）。
    *   **Session 复用**：登录成功后缓存 Token 和 Cookie，避免频繁登录，且支持多账号隔离。
    *   **自动救援**：检测到 Token 失效时，自动利用保存的凭证在后台静默重新登录。

*   **强大的订场模式**：
    *   **狙击抢票**：精确扫描指定时间段的空闲场地并在毫秒级内完成预定。
    *   **无限锁场**：抢到场地后不立即支付，而是通过特殊的“前置检查 + 爆发续订”机制（每10分钟周期的第9分钟进行高频续订），实现长时间占用场地（如占位等待队友确认）。

*   **安全与稳定性**：
    *   **白名单机制**：通过 `allowed_users.txt` 控制允许使用系统的账号。
    *   **僵尸进程清理**：智能管理 Chrome 进程，防止资源耗尽。
    *   **邮件通知**：抢票成功或锁场异常时发送邮件提醒。

## 🛠️ 部署教程

### 1. 环境准备
确保服务器或本地电脑安装以下环境：
- **Node.js**: 推荐 LTS 版本 (用于构建前端)。
- **Python**: 3.8+ (后端运行环境)。
- **Google Chrome**: 最新版。
- **ChromeDriver**: 与 Chrome 版本匹配的驱动程序 (系统会自动尝试下载，但建议手动配置)。

### 2. 安装依赖

**前端依赖**
```bash
npm install
```

**后端依赖**
```bash
pip install -r requirements.txt
```

### 3. 构建前端
生产环境部署前需编译前端资源：
```bash
npm run build
```
构建产物将生成在 `dist/` 目录下。

### 4. 配置文件

1.  **环境变量 (`.env`)**
    复制 `.env.example` 为 `.env` 并配置：
    ```properties
    # 设为 false 以显示浏览器界面 (调试用)，生产环境建议 true
    HEADLESS=true
    # 绑定地址
    SCUT_HOST=0.0.0.0
    # 管理员密钥 (可选)
    SCUT_ADMIN_KEY=your_secret_key
    ```

2.  **白名单 (`allowed_users.txt`)**
    在项目根目录创建或编辑此文件，每行一个允许登录的账号（学号）。支持使用 `#` 添加注释：
    ```text
    202320100334 # 张三
    202320100335 # 李四
    # 这是一个注释行
    ```

### 5. 启动服务

```bash
python server.py
```
默认访问地址：`http://localhost:5000`

---

## 📖 使用指南

### 登录与验证
1. 在网页端输入学号和统一认证密码。
2. 系统会自动尝试登录。如遇 2FA 验证，请留意界面提示或日志输出，并在有效时间内提交验证码。

### 发起任务
*   **普通抢票**：选择日期、时间，关闭“锁场模式”开关。系统抢到即止。
*   **无限锁场**：开启“锁场模式”。
    *   系统抢到场地后会进入保活循环。
    *   **注意**：系统会在场地到期前的 **1分10秒** 左右开始密集续订。请务必在此之前手动支付或取消，否则可能因续订失败导致场地丢失。

## ⚠️ 注意事项
*   本项目仅供学习交流，请勿通过非正常手段恶意占用公共资源。
*   部署在 Linux 服务器时，请确保安装了 Chrome 及相关依赖库（如 `libnss3` 等）。

## 📝 开发与调试
*   **本地开发**：可以设置 `HEADLESS=false` 以观察浏览器自动化操作过程。
*   **日志**：后端会输出详细的运行日志，包括登录流程、Token 嗅探、抢票状态等。
